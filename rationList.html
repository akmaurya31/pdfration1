<div id="header"></div>
<div class="container my-4 mx-auto">
  <h4 class="text-xl text-center bg-blue-500 text-white py-2 my-4 rounded font-bold mx-auto w-[30%]">ðŸ§‘All Ration ListðŸ›’</h4>

  <div class="max-w-[1350px] mx-auto text-center py-2">
    <input type="text" id="searchInput" placeholder="Search by Mobile, Name or Ration Card" class="border p-2 w-[50%]" />
    <button onclick="loadData(1)" class="bg-blue-500 text-white py-2 px-4 rounded">Search</button>
  </div>

  <div class="max-w-[1350px] mx-auto">
    <table id="requestTable" class="w-full text-sm text-left text-black-500">
      <thead class="bg-gray-100 border-b border-gray-200">
        <tr class="text-left">
          <th class="px-6 py-3 font-bold text-gray-700">Sn</th>
          <th class="px-6 py-3 font-bold text-gray-700">User ID</th>
          <th class="px-6 py-3 font-bold text-gray-700">Candidate Name</th>
          <th class="px-6 py-3 font-bold text-gray-700">Janpad</th>
          <th class="px-6 py-3 font-bold text-gray-700">Ration Card No.</th>
          <th class="px-6 py-3 font-bold text-gray-700">Action</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    <div class="flex justify-between items-center mt-4 mx-auto">
    <span id="pageInfo" class="text-gray-600"></span>
    <div class="flex items-center space-x-2">
        <input type="number" id="pageNumberInput" placeholder="Page #" class="border p-1 w-16 text-center">
        <button onclick="goToPage()" class="bg-green-500 text-white py-1 px-4 rounded">Go</button>
        <button onclick="prevPage()" class="bg-blue-500 text-white py-1 px-4 rounded">Previous</button>
        <button onclick="nextPage()" class="bg-blue-500 text-white py-1 px-4 rounded">Next</button>
    </div>
    </div>
  </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script> 
 let currentPage = 1;
let totalPages = 1;
let totalRecords = 0;

function loadData(page) {
  const search = document.getElementById('searchInput').value;
  const role = localStorage.getItem('role') || '';   // admin/user
  const userId = localStorage.getItem('id') || '';
  const contact_number = localStorage.getItem('contact_number') || 0;
  const current_balance = localStorage.getItem('current_balance') || 0;

  // SweetAlert loader à¤¦à¤¿à¤–à¤¾à¤à¤
  Swal.fire({
    title: 'Fetching Data...',
    text: 'à¤•à¥ƒà¤ªà¤¯à¤¾ à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¾ à¤•à¤°à¥‡à¤‚',
    allowOutsideClick: false,
    didOpen: () => {
      Swal.showLoading();
    }
  });

  fetch(`https://script.google.com/macros/s/AKfycbyTu4eMHfZ9aIxXem8BD4g8hrwpU8vzZ9gdAxVuScRigtuWJDVwPh9shS3sXevLx8-EZA/exec?page=${page}&search=${encodeURIComponent(search)}&role=${role}&userId=${userId}`)
    .then(res => res.json())
    .then(data => {
      Swal.close(); // loader à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚

      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      let pdfCell = '';
      if (row.pdf_path && row.pdf_path.trim() !== '') {
        pdfCell = `<td class="px-6 py-3">
                    <a class="text-blue-500 hover:underline" target="_blank" href="${row.pdf_path}">Download PDF</a>
                  </td>`;
      } else {
        pdfCell = `<td class="px-6 py-3"></td>`; // à¤–à¤¾à¤²à¥€ cell
      }


      data.data.forEach((row, i) => {
        tbody.innerHTML += `
          <tr>
            <td class="px-6 py-3 font-bold">${i + 1 + (page - 1) * 10}</td>
            <td class="px-6 py-3 font-bold">${contact_number}<br/>Balance: ${current_balance}</td>
            <td class="px-6 py-3 font-bold">${row.name}</td>
            <td class="px-6 py-3 font-bold">${row.janpad}<br/>${row.edate}</td>
            <td class="px-6 py-3 font-bold">${row.ration}</td>
            ${pdfCell}
          </tr>`;
      });

      currentPage = data.page;
      totalPages = data.totalPages;
      totalRecords = data.totalRecords;

      document.getElementById('pageInfo').innerText =
        `Page ${currentPage} of ${totalPages} â€” Total Records: ${totalRecords}`;
    })
    .catch(err => {
      Swal.close(); // loader à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚
      console.error(err);
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Data fetch à¤•à¤°à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤¹à¥à¤ˆà¥¤'
      });
    });
}

function prevPage() {
  if (currentPage > 1) loadData(currentPage - 1);
}

function nextPage() {
  if (currentPage < totalPages) loadData(currentPage + 1);
}

function goToPage() {
  const pageInput = parseInt(document.getElementById('pageNumberInput').value, 10);
  if (!isNaN(pageInput) && pageInput >= 1 && pageInput <= totalPages) {
    loadData(pageInput);
  } else {
    alert('Please enter a valid page number between 1 and ' + totalPages);
  }
}

// à¤ªà¤¹à¤²à¥‡ page à¤•à¥‹ load à¤•à¤°à¥‡à¤‚
loadData(1);


</script>
  <script src="script.js"></script>
